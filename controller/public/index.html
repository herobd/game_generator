<!DOCTYPE html>
<html>
<head>
<title>Controller</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="default.css" rel="stylesheet" type="text/css" />
<script>
var checked=null;
function check(val) {
    checked = val;
}
var checked2="short";
function check2(val) {
    checked2 = val;
}
function httpGetAsync(theUrl, callback)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
            callback(xmlHttp.responseText);
        else if (xmlHttp.readyState == 4)
            callback(xmlHttp.status);
            
    }
    xmlHttp.open("GET", theUrl, true); // true for asynchronous 
    xmlHttp.send(null);
}
function httpPostAsync(theUrl, theData, callback)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
            callback(xmlHttp.responseText);
        else if (xmlHttp.readyState == 4)
            callback(xmlHttp.status);
            
    }
    xmlHttp.open("POST", theUrl, true); // true for asynchronous 
    xmlHttp.setRequestHeader("Content-type", 'application/json');
    xmlHttp.send(JSON.stringify(theData));
}
function submit_player() {
    var method=checked;
    if (checked==='other')
        method=document.getElementById("othermethod").value;
    var host=document.getElementById("host").value;
    var port=document.getElementById("port").value;
    var name=document.getElementById("name").value;
    var skillLevel=document.getElementById("skillLevel").value;
    var gdlVersion=document.getElementById("gdlVersion").value;
    var url = '/addPlayer?method='+method+'&host='+host+'&port='+port+'&name='+name+'&skillLevel='+skillLevel+'&gdlVersion='+gdlVersion;
    document.getElementById("submit_show").innerHTML = 'submitting...';
    httpGetAsync(encodeURI(url),function(res) {
        document.getElementById("submit_show").innerHTML = res;
    });
}

function submit_game() {
    var id=document.getElementById("meta_id").value;
    var name=document.getElementById("meta_name").value;
    var score=document.getElementById("meta_score").value;
    var gdlVersion=document.getElementById("meta_gdlVersion").value;
    var testLength=checked2;
    var numPlayers=document.getElementById("meta_numPlayers").value;
    var gdl=document.getElementById("gdl").value;
    var hlgdl=document.getElementById("hlgdl").value;
    var url = '/submit_game'
    var meta = {  id:id,
                    name:name,
                    score:score,
                    testLength:testLength,
                    numPlayers:numPlayers,
                    gdlVersion:gdlVersion
               }
    document.getElementById("game_submit_show").innerHTML = 'submitting...';
    httpPostAsync(encodeURI(url),{meta:meta, gdl:gdl, hlgdl:hlgdl},function(res) {
        document.getElementById("game_submit_show").innerHTML = res;
    });
}

function connect_eval() {
    var method=checked;
    var address=document.getElementById("eval").value;
    var url = '/executeConnect?address='+address;
    document.getElementById("eval_show").innerHTML = 'connecting...';
    httpGetAsync(encodeURI(url),function(res) {
        document.getElementById("eval_show").innerHTML = res;
    });
}
</script>
</head>
<body>
<div id="add_player_box">
    <h2>PEGGASUS: Parallel Evolutionary Game Generation and Simulation Unifying System</h2>
    By Brian Davis and Lawrence Thatcher
    <br>
    <h2>Add player</h2>
    Host: <input type="text" id="host"><br>
    Port: <input type="text" id="port"><br>
    Method:<br>
      <input type="radio" name="method" value="minimax" onclick="check(this.value)"> Minimax<br>
      <input type="radio" name="method" value="heurisitc" onclick="check(this.value)"> Heurisitc<br>
      <input type="radio" name="method" value="montecarlo" onclick="check(this.value)"> Monte Carlo<br>
      <input type="radio" name="method" value="montecarlotreesearch" onclick="check(this.value)"> Monte Carlo Tree Search<br>
      <input type="radio" name="method" value="other" onclick="check(this.value)"> <input type="text" id="othermethod"> (note: use consistent spelling)<br>
    Name: <input type="text" id="name"><br>
    Skill level: <input type="text" id="skillLevel"><br>
    GDL Version: <input type="text" id="gdlVersion" value="1"><br>
    <button type="button" onclick="submit_player()" id="submit_player_button">Submit player</button><br>
    Status: <div id="submit_show">not submitted</div>
</div>
<div id="connect_to_eval_box">
    <h2>Connect to</h2>
    Evaluator: <input type="text" id="eval"><br>
    <button type="button" onclick="connect_eval()" id="connect_evaluator_button">Connect</button><br>
    Status: <div id="eval_show">not connected</div>
</div>
<div id="submit_game_box">
    <h2>Submit game</h2>
    ID: <input type="text" id="meta_id" value="test"><br>
    name: <input type="text" id="meta_name" value="TicTacToe"><br>
    number of players: <input type="text" id="meta_numPlayers" value="2"><br>
    GDL version: <input type="text" id="meta_gdlVersion" value="1"><br>
    intrinsic score: <input type="text" id="meta_score" value="1.0"><br>
    test length: <br>
      <input type="radio" name="meta_testLength" value="short" onclick="check2(this.value)"> Short<br>
      <input type="radio" name="meta_testLength" value="med" onclick="check2(this.value)"> Medium<br>
      <input type="radio" name="meta_testLength" value="long" onclick="check2(this.value)"> Long<br>
    GDL: <br><textarea rows="30" cols="70" id="gdl">
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; Tictactoe
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Roles
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(role xplayer)
(role oplayer)

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Base & Input
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(index 1) (index 2) (index 3)
(<= (base (cell ?x ?y b)) (index ?x) (index ?y))
(<= (base (cell ?x ?y x)) (index ?x) (index ?y))
(<= (base (cell ?x ?y o)) (index ?x) (index ?y))
(<= (base (control ?p)) (role ?p))

(<= (input ?p (mark ?x ?y)) (index ?x) (index ?y) (role ?p))
(<= (input ?p noop) (role ?p))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Initial State
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(init (cell 1 1 b))
(init (cell 1 2 b))
(init (cell 1 3 b))
(init (cell 2 1 b))
(init (cell 2 2 b))
(init (cell 2 3 b))
(init (cell 3 1 b))
(init (cell 3 2 b))
(init (cell 3 3 b))
(init (control xplayer))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Dynamic Components
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;; Cell

(<= (next (cell ?m ?n x))
(does xplayer (mark ?m ?n))
(true (cell ?m ?n b)))

(<= (next (cell ?m ?n o))
(does oplayer (mark ?m ?n))
(true (cell ?m ?n b)))

(<= (next (cell ?m ?n ?w))
(true (cell ?m ?n ?w))
(distinct ?w b))

(<= (next (cell ?m ?n b))
(does ?w (mark ?j ?k))
(true (cell ?m ?n b))
(or (distinct ?m ?j) (distinct ?n ?k)))

(<= (next (control xplayer))
(true (control oplayer)))

(<= (next (control oplayer))
(true (control xplayer)))


(<= (row ?m ?x)
(true (cell ?m 1 ?x))
(true (cell ?m 2 ?x))
(true (cell ?m 3 ?x)))

(<= (column ?n ?x)
(true (cell 1 ?n ?x))
(true (cell 2 ?n ?x))
(true (cell 3 ?n ?x)))

(<= (diagonal ?x)
(true (cell 1 1 ?x))
(true (cell 2 2 ?x))
(true (cell 3 3 ?x)))

(<= (diagonal ?x)
(true (cell 1 3 ?x))
(true (cell 2 2 ?x))
(true (cell 3 1 ?x)))


(<= (line ?x) (row ?m ?x))
(<= (line ?x) (column ?m ?x))
(<= (line ?x) (diagonal ?x))


(<= open
(true (cell ?m ?n b)))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(<= (legal ?w (mark ?x ?y))
(true (cell ?x ?y b))
(true (control ?w)))

(<= (legal xplayer noop)
(true (control oplayer)))

(<= (legal oplayer noop)
(true (control xplayer)))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(<= (goal xplayer 100)
(line x))

(<= (goal xplayer 50)
(not (line x))
(not (line o))
(not open))

(<= (goal xplayer 0)
(line o))

(<= (goal oplayer 100)
(line o))

(<= (goal oplayer 50)
(not (line x))
(not (line o))
(not open))

(<= (goal oplayer 0)
(line x))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(<= terminal
(line x))

(<= terminal
(line o))

(<= terminal
(not open))
    </textarea> <br>
    HAGDL: <br><textarea rows="30" cols="70" id="hlgdl"> NO HAGDL </textarea> <br>
    <button type="button" onclick="submit_game()" id="submit_game_button">Submit</button><br>
    Status: <div id="game_submit_show">---</div>
</div>
</body>
</html>
